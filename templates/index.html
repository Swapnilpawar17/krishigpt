<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KrishiGPT - AI рдХреГрд╖рд┐ рд╕рд▓рд╛рд╣рдХрд╛рд░ ЁЯМ╛</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts - Noto Sans Devanagari for Hindi/Marathi -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            font-family: 'Noto Sans Devanagari', sans-serif;
        }
        
        /* Chat container height */
        .chat-container {
            height: calc(100vh - 280px);
            min-height: 300px;
        }
        
        /* Message bubbles */
        .message {
            max-width: 85%;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            background: linear-gradient(135deg, #dcf8c6 0%, #c5f0a4 100%);
            border-radius: 18px 18px 4px 18px;
        }
        
        .bot-message {
            background: #ffffff;
            border-radius: 18px 18px 18px 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        /* Typing indicator */
        .typing-indicator {
            display: none;
        }
        
        .typing-indicator.show {
            display: flex;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background-color: #10b981;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
            30% { transform: translateY(-8px); opacity: 1; }
        }
        
        /* Quick button hover effect */
        .quick-btn {
            transition: all 0.2s ease;
        }
        
        .quick-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        /* Scrollbar styling */
        .chat-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .chat-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        .chat-container::-webkit-scrollbar-thumb {
            background: #10b981;
            border-radius: 3px;
        }
        
        /* Mobile responsive */
        @media (max-width: 640px) {
            .chat-container {
                height: calc(100vh - 320px);
            }
            
            .message {
                max-width: 90%;
            }
        }
        
        /* Format AI response */
        .bot-message p {
            margin-bottom: 0.5rem;
        }
        
        .bot-message strong {
            color: #059669;
        }
        
        /* Preserve whitespace and formatting */
        .response-text {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-green-50 to-emerald-100 min-h-screen">
    
    <!-- Header -->
    <header class="bg-gradient-to-r from-green-600 to-emerald-600 text-white py-4 px-4 shadow-lg">
        <div class="max-w-4xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="text-4xl">ЁЯМ╛</div>
                <div>
                    <h1 class="text-xl md:text-2xl font-bold">KrishiGPT</h1>
                    <p class="text-xs md:text-sm text-green-200">AI рдХреГрд╖рд┐ рд╕рд▓рд╛рд╣рдХрд╛рд░ | рдХрд┐рд╕рд╛рдиреЛрдВ рдХрд╛ рдорд┐рддреНрд░</p>
                </div>
            </div>
            <button 
                onclick="clearChat()" 
                class="bg-green-700 hover:bg-green-800 px-3 py-2 rounded-lg text-sm font-medium transition flex items-center space-x-1"
            >
                <span>ЁЯФД</span>
                <span class="hidden md:inline">рдирдИ рдмрд╛рддрдЪреАрдд</span>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto p-4">
        
        <!-- Chat Container -->
        <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl overflow-hidden border border-green-100">
            
            <!-- Chat Messages Area -->
            <div id="chat-messages" class="chat-container overflow-y-auto p-4 space-y-4 bg-gradient-to-b from-green-50/50 to-white/50">
                
                <!-- Welcome Message -->
                <div class="message bot-message p-4 shadow-sm">
                    <div class="flex items-center space-x-2 mb-2">
                        <span class="text-2xl">ЁЯдЦ</span>
                        <span class="font-bold text-green-700">KrishiGPT</span>
                    </div>
                    <div class="text-gray-700">
                        <p class="text-lg font-semibold text-green-800 mb-3">ЁЯМ╛ рдирдорд╕реНрдХрд╛рд░ рдХрд┐рд╕рд╛рди рднрд╛рдИ! ЁЯЩП</p>
                        <p class="mb-3">рдореИрдВ <strong>KrishiGPT</strong> рд╣реВрдВ - рдЖрдкрдХрд╛ AI рдХреГрд╖рд┐ рд╕рд▓рд╛рд╣рдХрд╛рд░ред</p>
                        <p class="mb-2">рдЖрдк рдореБрдЭрд╕реЗ рдкреВрдЫ рд╕рдХрддреЗ рд╣реИрдВ:</p>
                        <ul class="ml-4 space-y-1 text-gray-600">
                            <li>тЬЕ рдлрд╕рд▓ рдХреА рдмреАрдорд╛рд░реА рдФрд░ рдЗрд▓рд╛рдЬ</li>
                            <li>тЬЕ рдЦрд╛рдж-рдЙрд░реНрд╡рд░рдХ рдХреА рдЬрд╛рдирдХрд╛рд░реА</li>
                            <li>тЬЕ рд╕рд░рдХрд╛рд░реА рдпреЛрдЬрдирд╛рдПрдВ (PM-KISAN, рдмреАрдорд╛)</li>
                            <li>тЬЕ рдХреАрдЯ рдирд┐рдпрдВрддреНрд░рдг</li>
                        </ul>
                        <p class="mt-3 text-gray-500 text-sm">ЁЯСЗ рдиреАрдЪреЗ рдЕрдкрдирд╛ рд╕рд╡рд╛рд▓ рд╣рд┐рдВрджреА рдпрд╛ рдорд░рд╛рдареА рдореЗрдВ рд▓рд┐рдЦреЗрдВ</p>
                    </div>
                </div>
                
            </div>
            
            <!-- Typing Indicator -->
            <div id="typing-indicator" class="typing-indicator items-center space-x-2 px-4 py-3 bg-gray-50 border-t border-gray-100">
                <div class="flex items-center space-x-1 bg-white px-4 py-2 rounded-full shadow-sm">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
                <span class="text-sm text-gray-500 ml-2">KrishiGPT рд╕реЛрдЪ рд░рд╣рд╛ рд╣реИ...</span>
            </div>
            
            <!-- Input Area -->
            <div class="bg-white p-4 border-t border-gray-100">
                <form id="chat-form" class="flex space-x-2">
                    <input 
                        type="text" 
                        id="user-input" 
                        placeholder="рдЕрдкрдирд╛ рд╕рд╡рд╛рд▓ рдпрд╣рд╛рдВ рд▓рд┐рдЦреЗрдВ... (рдЙрджрд╛: рдЯрдорд╛рдЯрд░ рдореЗрдВ рдкрддреНрддреЗ рдкреАрд▓реЗ рд╣реЛ рд░рд╣реЗ рд╣реИрдВ)"
                        class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition text-gray-700"
                        autocomplete="off"
                        autofocus
                    >
                    <button 
                        type="submit" 
                        id="send-btn"
                        class="bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white px-6 py-3 rounded-xl font-bold transition duration-200 flex items-center space-x-2 shadow-lg hover:shadow-xl"
                    >
                        <span>рднреЗрдЬреЗрдВ</span>
                        <span>тЮд</span>
                    </button>
                </form>
            </div>
        </div>
        
        <!-- Quick Question Buttons -->
        <div class="mt-4">
            <p class="text-gray-600 mb-3 font-medium">ЁЯЪА рдЬрд▓реНрджреА рдкреВрдЫреЗрдВ:</p>
            <div class="flex flex-wrap gap-2">
                <button onclick="askQuestion('рдЯрдорд╛рдЯрд░ рдореЗрдВ рдкрддреНрддреЗ рдкреАрд▓реЗ рд╣реЛ рд░рд╣реЗ рд╣реИрдВ, рдХреНрдпрд╛ рдХрд░реВрдВ?')" 
                    class="quick-btn bg-white px-4 py-2 rounded-full text-sm hover:bg-green-50 border-2 border-green-200 text-gray-700 font-medium">
                    ЁЯНЕ рдЯрдорд╛рдЯрд░ рдореЗрдВ рдкреАрд▓реЗ рдкрддреНрддреЗ
                </button>
                <button onclick="askQuestion('рдХрдкрд╛рд╕ рдореЗрдВ рдЧреБрд▓рд╛рдмреА рд╕реБрдВрдбреА рдХрд╛ рдЗрд▓рд╛рдЬ рдмрддрд╛рдУ')" 
                    class="quick-btn bg-white px-4 py-2 rounded-full text-sm hover:bg-green-50 border-2 border-green-200 text-gray-700 font-medium">
                    ЁЯМ┐ рдХрдкрд╛рд╕ рдореЗрдВ рдЧреБрд▓рд╛рдмреА рд╕реБрдВрдбреА
                </button>
                <button onclick="askQuestion('рдкреНрдпрд╛рдЬ рдореЗрдВ рдереНрд░рд┐рдкреНрд╕ рдХрд╛ рдЙрдкрдЪрд╛рд░ рдмрддрд╛рдУ')" 
                    class="quick-btn bg-white px-4 py-2 rounded-full text-sm hover:bg-green-50 border-2 border-green-200 text-gray-700 font-medium">
                    ЁЯзЕ рдкреНрдпрд╛рдЬ рдореЗрдВ рдереНрд░рд┐рдкреНрд╕
                </button>
                <button onclick="askQuestion('PM-KISAN рдпреЛрдЬрдирд╛ рдХреА рдЬрд╛рдирдХрд╛рд░реА рджреЛ')" 
                    class="quick-btn bg-white px-4 py-2 rounded-full text-sm hover:bg-green-50 border-2 border-green-200 text-gray-700 font-medium">
                    ЁЯТ░ PM-KISAN рдпреЛрдЬрдирд╛
                </button>
                <button onclick="askQuestion('рдЧреЗрд╣реВрдВ рдореЗрдВ рд░рддреБрдЖ рд░реЛрдЧ рдХрд╛ рдЗрд▓рд╛рдЬ')" 
                    class="quick-btn bg-white px-4 py-2 rounded-full text-sm hover:bg-green-50 border-2 border-green-200 text-gray-700 font-medium">
                    ЁЯМ╛ рдЧреЗрд╣реВрдВ рдореЗрдВ рд░рддреБрдЖ
                </button>
                <button onclick="askQuestion('рд╕реЛрдпрд╛рдмреАрди рдореЗрдВ рдХреМрди рд╕реА рдЦрд╛рдж рдбрд╛рд▓реЗрдВ?')" 
                    class="quick-btn bg-white px-4 py-2 rounded-full text-sm hover:bg-green-50 border-2 border-green-200 text-gray-700 font-medium">
                    ЁЯлШ рд╕реЛрдпрд╛рдмреАрди рдореЗрдВ рдЦрд╛рдж
                </button>
                <button onclick="askQuestion('рдЕрдирд╛рд░ рдореЗрдВ рддреЗрд▓рд┐рдпрд╛ рд░реЛрдЧ рдХрд╛ рдЙрдкрдЪрд╛рд░')" 
                    class="quick-btn bg-white px-4 py-2 rounded-full text-sm hover:bg-green-50 border-2 border-green-200 text-gray-700 font-medium">
                    ЁЯНО рдЕрдирд╛рд░ рдореЗрдВ рддреЗрд▓рд┐рдпрд╛
                </button>
                <button onclick="askQuestion('рдХрд┐рд╕рд╛рди рд╣реЗрд▓реНрдкрд▓рд╛рдЗрди рдирдВрдмрд░ рдмрддрд╛рдУ')" 
                    class="quick-btn bg-white px-4 py-2 rounded-full text-sm hover:bg-green-50 border-2 border-green-200 text-gray-700 font-medium">
                    ЁЯУЮ рд╣реЗрд▓реНрдкрд▓рд╛рдЗрди рдирдВрдмрд░
                </button>
            </div>
        </div>
        
        <!-- Info Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
            <div class="bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow-md border border-green-100">
                <div class="text-2xl mb-2">ЁЯМ▒</div>
                <h3 class="font-bold text-green-800">8 рдлрд╕рд▓реЗрдВ</h3>
                <p class="text-sm text-gray-600">рдЯрдорд╛рдЯрд░, рдкреНрдпрд╛рдЬ, рдХрдкрд╛рд╕, рдЧреЗрд╣реВрдВ, рдЧрдиреНрдирд╛, рд╕реЛрдпрд╛рдмреАрди, рдЕрдВрдЧреВрд░, рдЕрдирд╛рд░</p>
            </div>
            <div class="bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow-md border border-green-100">
                <div class="text-2xl mb-2">ЁЯТК</div>
                <h3 class="font-bold text-green-800">рдмреАрдорд╛рд░реА рдкрд╣рдЪрд╛рди</h3>
                <p class="text-sm text-gray-600">рд▓рдХреНрд╖рдг рдмрддрд╛рдПрдВ, рдЗрд▓рд╛рдЬ рдкрд╛рдПрдВ</p>
            </div>
            <div class="bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow-md border border-green-100">
                <div class="text-2xl mb-2">ЁЯУЛ</div>
                <h3 class="font-bold text-green-800">рд╕рд░рдХрд╛рд░реА рдпреЛрдЬрдирд╛рдПрдВ</h3>
                <p class="text-sm text-gray-600">PM-KISAN, рдмреАрдорд╛, KCC рдХреА рдЬрд╛рдирдХрд╛рд░реА</p>
            </div>
        </div>
        
    </main>

    <!-- Footer -->
    <footer class="text-center py-4 mt-6">
        <p class="text-gray-600 text-sm">ЁЯМ▒ KrishiGPT - рдХрд┐рд╕рд╛рдиреЛрдВ рдХреЗ рд▓рд┐рдП AI рд╕рд▓рд╛рд╣рдХрд╛рд░</p>
        <p class="text-gray-500 text-xs mt-1">тЪая╕П рдпрд╣ AI рд╕рд▓рд╛рд╣ рд╣реИред рдЧрдВрднреАрд░ рд╕рдорд╕реНрдпрд╛ рдореЗрдВ рдХреГрд╖рд┐ рдЕрдзрд┐рдХрд╛рд░реА рд╕реЗ рдорд┐рд▓реЗрдВред</p>
        <p class="text-gray-500 text-xs mt-1">ЁЯУЮ рдХрд┐рд╕рд╛рди рд╣реЗрд▓реНрдкрд▓рд╛рдЗрди: <strong>1551</strong> (рдЯреЛрд▓ рдлреНрд░реА)</p>
    </footer>

    <!-- JavaScript -->
    <script>
        // Generate unique user ID for this session
        let userId = localStorage.getItem('krishigpt_user_id');
        if (!userId) {
            userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('krishigpt_user_id', userId);
        }

        // DOM Elements
        const chatMessages = document.getElementById('chat-messages');
        const chatForm = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const typingIndicator = document.getElementById('typing-indicator');

        // Scroll to bottom of chat
        function scrollToBottom() {
            setTimeout(() => {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 100);
        }

        // Format AI response (convert markdown-like formatting)
        function formatResponse(text) {
            // Bold text: **text** -> <strong>text</strong>
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            // Convert line breaks
            text = text.replace(/\n/g, '<br>');
            
            return text;
        }

        // Add message to chat
        function addMessage(text, isUser) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message ml-auto' : 'bot-message'} p-4`;
            
            if (isUser) {
                messageDiv.innerHTML = `
                    <div class="flex items-center space-x-2 mb-1">
                        <span class="text-lg">ЁЯСитАНЁЯМ╛</span>
                        <span class="font-semibold text-gray-700">рдЖрдк</span>
                    </div>
                    <p class="text-gray-800">${escapeHtml(text)}</p>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="flex items-center space-x-2 mb-2">
                        <span class="text-xl">ЁЯдЦ</span>
                        <span class="font-bold text-green-700">KrishiGPT</span>
                    </div>
                    <div class="response-text text-gray-700">${formatResponse(text)}</div>
                `;
            }
            
            chatMessages.appendChild(messageDiv);
            scrollToBottom();
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Show typing indicator
        function showTyping() {
            typingIndicator.classList.add('show');
            scrollToBottom();
        }

        // Hide typing indicator
        function hideTyping() {
            typingIndicator.classList.remove('show');
        }

        // Send message to API
        async function sendMessage(message) {
            try {
                showTyping();
                sendBtn.disabled = true;
                sendBtn.innerHTML = '<span>рднреЗрдЬ рд░рд╣рд╛...</span>';
                userInput.disabled = true;

                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        message: message
                    })
                });

                const data = await response.json();
                hideTyping();

                if (data.success) {
                    addMessage(data.response, false);
                } else {
                    addMessage('тЭМ рдХреБрдЫ рдЧрд▓рдд рд╣реЛ рдЧрдпрд╛: ' + (data.error || 'Unknown error'), false);
                }

            } catch (error) {
                console.error('Error:', error);
                hideTyping();
                addMessage('тЭМ рд╕рд░реНрд╡рд░ рд╕реЗ рдХрдиреЗрдХреНрд╢рди рдирд╣реАрдВ рд╣реЛ рдкрд╛рдпрд╛ред рдХреГрдкрдпрд╛ рдЗрдВрдЯрд░рдиреЗрдЯ рдЪреЗрдХ рдХрд░реЗрдВ рдФрд░ рдлрд┐рд░ рд╕реЗ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред', false);
            } finally {
                sendBtn.disabled = false;
                sendBtn.innerHTML = '<span>рднреЗрдЬреЗрдВ</span><span>тЮд</span>';
                userInput.disabled = false;
                userInput.focus();
            }
        }

        // Handle form submit
        chatForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const message = userInput.value.trim();
            
            if (message) {
                addMessage(message, true);
                userInput.value = '';
                sendMessage(message);
            }
        });

        // Quick question button click
        function askQuestion(question) {
            userInput.value = question;
            chatForm.dispatchEvent(new Event('submit'));
        }

        // Clear chat history
        async function clearChat() {
            try {
                await fetch('/api/clear-history', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_id: userId })
                });
                
                // Clear chat UI except welcome message
                const messages = chatMessages.querySelectorAll('.message');
                messages.forEach((msg, index) => {
                    if (index > 0) { // Keep first message (welcome)
                        msg.remove();
                    }
                });
                
                // Add confirmation
                addMessage('ЁЯФД рдмрд╛рддрдЪреАрдд рд╕рд╛рдл рд╣реЛ рдЧрдИред рдирдпрд╛ рд╕рд╡рд╛рд▓ рдкреВрдЫреЗрдВ!', false);
                
            } catch (error) {
                console.error('Error clearing chat:', error);
            }
        }

        // Handle Enter key
        userInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                chatForm.dispatchEvent(new Event('submit'));
            }
        });

        // Focus on input when page loads
        window.onload = function() {
            userInput.focus();
            scrollToBottom();
        };

        // Service Worker for offline capability (optional)
        if ('serviceWorker' in navigator) {
            // Can be added later for PWA functionality
        }
    </script>
</body>
</html>